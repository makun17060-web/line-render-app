<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Flex メッセージ送信</title>
<style>
  body { font-family: sans-serif; padding: 24px; max-width: 600px; margin: auto; }
  textarea { width: 100%; height: 260px; font-family: monospace; }
  input { width:100%; padding:6px; margin-bottom:10px; }
  button { padding: 12px 20px; margin-top: 12px; cursor:pointer; }
</style>
</head>
<body>
<h2>Flex メッセージ送信（管理者用）</h2>

<p>管理トークン（ADMIN_API_TOKEN）</p>
<input id="tokenInput" type="text" placeholder="ADMIN_API_TOKEN を入力">

<p>Flex JSON</p>
<textarea id="jsonInput" placeholder='{
  "type": "bubble",
  "body": {
    "type": "box",
    "layout": "vertical",
    "contents": [
      { "type": "text", "text": "サンプル", "weight": "bold", "size": "lg" }
    ]
  }
}'></textarea>

<button onclick="sendFlex()">送信</button>

<p id="result"></p>

<script>
async function sendFlex() {
  const token = document.getElementById("tokenInput").value.trim();
  const json = document.getElementById("jsonInput").value.trim();
  if (!token || !json) { alert("トークンとJSONを入力してください"); return; }

  let flex;
  try { flex = JSON.parse(json); }
  catch(e) { alert("JSON の形式が正しくありません"); return; }

  const res = await fetch("/api/admin/broadcast-flex", {
    method: "POST",
    headers: {
      "Authorization": "Bearer " + token,
      "Content-Type": "application/json"
    },
    body: JSON.stringify(flex)
  });

  document.getElementById("result").innerText = await res.text();
}
</script>

</body>
</html>
