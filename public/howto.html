<script>
  const LINKS = {
    ORDER_URL:   "https://line-render-app-1.onrender.com/public/products.html",
    ADDRESS_URL: "https://liff.line.me/2008406620-4kyQVyqe",
    SHIPPING_URL:"https://line-render-app-1.onrender.com/public/shipping.html",
    CHAT_TEXT:   "お問い合わせです。",
  };

  function openUrl(url, external=false){
    if (window.liff) {
      try {
        if (liff.isInClient()) {
          liff.openWindow({ url, external });
          return;
        }
      } catch {}
    }
    window.location.href = url;
  }

  async function init(){
    let inClient = false;
    if (window.liff) {
      try { inClient = liff.isInClient(); } catch {}
    }

    document.getElementById("envBadge").textContent =
      inClient ? "LINEアプリ内（LIFF）" : "ブラウザ表示";

    document.getElementById("btnClose").onclick = () => {
      if (inClient && window.liff) liff.closeWindow();
      else history.back();
    };

    document.getElementById("btnOrder").onclick =
      () => openUrl(LINKS.ORDER_URL, false);

    document.getElementById("btnAddress").onclick =
      () => openUrl(LINKS.ADDRESS_URL, false);

    document.getElementById("btnShipping").onclick =
      () => openUrl(LINKS.SHIPPING_URL, true);

    document.getElementById("btnChat").onclick = () => {
      if (inClient && window.liff) {
        liff.sendMessages([{ type:"text", text: LINKS.CHAT_TEXT }])
          .then(() => liff.closeWindow())
          .catch(() => {
            alert("トーク画面を開けませんでした。");
          });
      } else {
        alert("LINEアプリ内で開くと、そのままお問い合わせできます。");
      }
    };
  }

  document.addEventListener("DOMContentLoaded", init);
</script>
