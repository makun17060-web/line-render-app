function qp(name){ return new URLSearchParams(location.search).get(name); }

function safeReturnTo(v){
  if (!v) return "";
  const s = String(v);
  if (!s.startsWith("/")) return "";
  if (s.startsWith("//")) return "";
  if (s.includes("://")) return "";
  return s;
}

async function finishAfterSaved(){
  const from = qp("from");                 // howto
  const returnTo = safeReturnTo(qp("returnTo")); // /confirm.html ç­‰

  if (from === "howto") {
    if (window.liff && liff.isInClient()) { liff.closeWindow(); return; }
    history.back(); return;
  }
  if (returnTo) { location.href = returnTo; return; }
  location.href = "/products.html";
}
