<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>代引き注文完了</title>
  <style>
    :root{--bg:#f6f7f9;--card:#fff;--text:#111827;--muted:#6b7280;--line:#e5e7eb;--pri:#0b3a53;}
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:720px;margin:0 auto;padding:14px 14px 26px}
    h1{margin:0 0 6px;font-size:18px}
    .muted{color:var(--muted);font-size:13px;line-height:1.5}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin-top:12px;box-shadow:0 1px 3px rgba(0,0,0,.06)}
    .row{display:flex;justify-content:space-between;gap:10px;margin:8px 0;font-size:14px}
    .big{font-weight:900;font-size:18px}
    button{border:none;border-radius:14px;padding:12px 14px;font-weight:900;cursor:pointer;width:100%;background:var(--pri);color:#fff}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>代引き注文を受け付けました</h1>
    <div class="muted" id="msg">表示中…</div>

    <div class="card">
      <div class="muted">注文ID</div>
      <div class="big" id="orderId">—</div>
      <div class="muted" style="margin-top:10px">金額</div>
      <div class="row"><div>小計</div><div id="subtotal">—</div></div>
      <div class="row"><div>送料</div><div id="shipping">—</div></div>
      <div class="row"><div>代引手数料</div><div id="codFee">—</div></div>
      <div class="row" style="font-weight:900"><div>合計（代引）</div><div id="total">—</div></div>
    </div>

    <div class="card">
      <button id="backBtn" type="button">商品一覧へ戻る</button>
    </div>
  </div>

<script>
(function(){
  "use strict";
  const KEY_LAST="isoya_last_order";
  const yen=n=>(Number(n)||0).toLocaleString("ja-JP")+"円";

  const params=new URLSearchParams(location.search);
  const orderId=params.get("orderId") || "";

  const msg=document.getElementById("msg");
  const orderIdEl=document.getElementById("orderId");
  const subtotalEl=document.getElementById("subtotal");
  const shippingEl=document.getElementById("shipping");
  const codFeeEl=document.getElementById("codFee");
  const totalEl=document.getElementById("total");

  document.getElementById("backBtn").onclick=()=>location.href="/products.html";

  // orderIdが無いなら勝手に表示させない（事故防止）
  if(!orderId){
    location.replace("/confirm.html");
    return;
  }

  orderIdEl.textContent = orderId;

  let last=null;
  try{ last=JSON.parse(localStorage.getItem(KEY_LAST)||""); }catch{}

  if(last && String(last.orderId||"")===String(orderId)){
    subtotalEl.textContent = yen(last.subtotal);
    shippingEl.textContent = yen(last.shippingFee);
    codFeeEl.textContent   = yen(last.codFee);
    totalEl.textContent    = yen(last.totalCod);
    msg.textContent = "ご注文ありがとうございました。発送準備に入ります。";
    // 表示後に消す（次回“勝手に完了画面”防止）
    localStorage.removeItem(KEY_LAST);
  }else{
    msg.textContent = "注文を受け付けました（詳細は注文履歴/管理で確認できます）。";
  }
})();
</script>
</body>
</html>
