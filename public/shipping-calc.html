<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>送料・総額の目安</title>

<style>
  body {
    font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    background:#f7f7f7; margin:0; padding:16px; color:#333;
  }
  .wrap { max-width:720px; margin:0 auto; }
  h1 { font-size:20px; margin:0 0 8px; }
  .lead { font-size:13px; color:#555; margin-bottom:12px; line-height:1.6; }
  .card {
    background:#fff; border-radius:12px; padding:14px; margin-bottom:12px;
    box-shadow:0 1px 3px rgba(0,0,0,.08);
  }
  label { font-size:13px; font-weight:700; display:block; margin:8px 0 4px; }
  select, input {
    width:100%; padding:10px; font-size:15px;
    border-radius:8px; border:1px solid #ccc;
  }
  button {
    width:100%; padding:12px; font-size:16px;
    border-radius:10px; border:0;
    background:#0b3a53; color:#fff; font-weight:700;
  }
  .result { font-size:15px; line-height:1.7; }
  .big { font-size:18px; font-weight:800; }
  .hr { height:1px; background:#eee; margin:10px 0; }
  .muted { font-size:12px; color:#777; }
</style>
</head>

<body>
<div class="wrap">

<h1>送料・総額の目安</h1>
<p class="lead">
  オンライン注文と<strong>完全に同一ロジック</strong>で計算します。<br>
  （最終金額は注文画面で確定）
</p>

<!-- お届け先 -->
<div class="card">
  <label>お届け先（都道府県）</label>
  <select id="pref">
    <option value="">選択してください</option>
    <option>北海道</option><option>青森県</option><option>岩手県</option><option>宮城県</option>
    <option>秋田県</option><option>山形県</option><option>福島県</option>
    <option>茨城県</option><option>栃木県</option><option>群馬県</option><option>埼玉県</option>
    <option>千葉県</option><option>東京都</option><option>神奈川県</option>
    <option>新潟県</option><option>富山県</option><option>石川県</option><option>福井県</option>
    <option>長野県</option><option>岐阜県</option><option>静岡県</option><option>愛知県</option><option>三重県</option>
    <option>滋賀県</option><option>京都府</option><option>大阪府</option>
    <option>兵庫県</option><option>奈良県</option><option>和歌山県</option>
    <option>鳥取県</option><option>島根県</option><option>岡山県</option><option>広島県</option><option>山口県</option>
    <option>徳島県</option><option>香川県</option><option>愛媛県</option><option>高知県</option>
    <option>福岡県</option><option>佐賀県</option><option>長崎県</option><option>熊本県</option>
    <option>大分県</option><option>宮崎県</option><option>鹿児島県</option><option>沖縄県</option>
  </select>
</div>

<!-- 商品選択 -->
<div class="card">
  <label>商品</label>
  <select id="productId">
    <option value="">選択してください</option>
    <option value="original-set">磯屋オリジナルセット</option>
    <option value="akasha">あかしゃシリーズ</option>
    <!-- ✅ 追加：久助（われせん） -->
    <option value="kusuke">久助（われせん）</option>
  </select>

  <label>数量</label>
  <input type="number" id="qty" min="1" value="1" />
</div>

<div class="card">
  <button onclick="calc()">送料を計算する</button>
</div>

<div class="card">
  <div id="result" class="result">―</div>
</div>

</div>

<script>
async function calc() {
  const result = document.getElementById("result");
  const pref = document.getElementById("pref").value;
  const productId = document.getElementById("productId").value;
  const qty = Number(document.getElementById("qty").value);

  if (!pref || !productId || qty <= 0) {
    result.textContent = "都道府県・商品・数量を正しく選択してください。";
    return;
  }

  // ✅ APIが受け取る product_id に変換
  // - 既存: original-set / akasha
  // - 追加: kusuke → サーバー側で akasha と同じサイズ判定に入る想定
  //   （あなたの server で /api/shipping/quote に kusuke を足してある前提）
  const apiProductId = (productId === "kusuke") ? "kusuke" : productId;

  const items = [
    { product_id: apiProductId, qty }
  ];

  try {
    const res = await fetch("/api/shipping/quote", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ pref, items })
    });

    const d = await res.json();
    if (!res.ok) {
      result.textContent = d?.error || "送料を取得できませんでした。";
      return;
    }

    result.innerHTML =
      `お届け先：<b>${d.region}</b><br>` +
      `サイズ：<b>${d.size}</b><br>` +
      `<div class="hr"></div>` +
      `送料：<b>${Number(d.shipping_fee).toLocaleString()}円</b><br>` +
      `<div class="big">総額の目安：${Number(d.total).toLocaleString()}円</div>` +
      `<div class="muted">※オンライン注文と同一計算</div>`;
  } catch (e) {
    result.textContent = "送料を取得できませんでした。";
  }
}
</script>

</body>
</html>
